/*
Programmer: Jason Whittle
Requester: Annie.L
Cherwell: 766199, 770993

Use: Pulls back patient concession details for a dyndoc: Pharmacy Admission
 */

; DROP PROGRAM WH_PATIENT_CONCESSIONS GO
; CREATE PROGRAM WH_PATIENT_CONCESSIONS
DROP PROGRAM VIC_GP_DETAILS:DBA GO
CREATE PROGRAM VIC_GP_DETAILS:DBA

%I CUST_SCRIPT:MA_RTF_TAGS.INC
%I CUST_SCRIPT:VIC_DS_COMMON_FONTS.INC

DECLARE ENCNTR_ID_VAR       = F8 WITH CONSTANT(REQUEST->VISIT[1].ENCNTR_ID), PROTECT
DECLARE PERSON_ID_VAR       = F8 WITH CONSTANT(REQUEST->PERSON[1].PERSON_ID), PROTECT
DECLARE DVA_GOLD_CD_VAR     = F8 WITH CONSTANT(4039501.00)
DECLARE DVA_GOLD_VAR        = VC WITH NOCONSTANT("")

/*
ALIAS_POOL_CD	ALIAS_POOL
    4039501.00	DVA GOLD
   13075331.00	Carer Payment Pension
    4455022.00	TAC
    4081892.00	Safety Net Concession Card
   14966006.00	Unemployment Related Benefits
   10719999.00	Safety Net Entitlement Card
    9569589.00	WHS UR Number
    6797507.00	DVA Number
   14966012.00	Emergency ID
    4039507.00	Medicare No
   13079326.00	Pension Concession Card
  174930721.00	NDIS Participant Identifier
   13079325.00	Disability Support Pension
    4081893.00	Healthcare Card
  152031769.00	CONSUMER_MESSAGING
   10726213.00	Pension - Other
    4443217.00	Work Cover
    6797508.00	Commonwealth Seniors Health Card
    4039502.00	DVA WHITE
*/

; Get the concession

SELECT INTO "NL:"
    ALIAS = PA.ALIAS
FROM
    PERSON_ALIAS      PA
WHERE
        PA.PERSON_ID = PERSON_ID_VAR
    AND	PA.ALIAS_POOL_CD = DVA_GOLD_CD_VAR
    AND PA.ACTIVE_IND = 1
DETAIL
    DVA_GOLD_VAR = TRIM(ALIAS, 3)
WITH
    TIME = 5


; DISPLAY THE DATA ON THE FRONT END
CALL APPLYFONT(ACTIVE_FONTS->NORMAL)

IF(TEXTLEN(DVA_GOLD_VAR) > 1)
    ; SET TEMPSTR = BUILD2(TEMPSTR,", ",TRIM(ENCNTR_INFO->GP_ADDRESS_LINE_2,3))
    CALL PRINTTEXT("DVA Gold Testing:",0,0,0)
    CALL PRINTTEXT()
ENDIF
CALL PRINTTEXT("DVA Gold Testing:",0,0,0)
CALL PRINTTEXT(DVA_GOLD_VAR)

; Send the text to Output
CALL FINISHTEXT(0)
SET REPLY->TEXT = RTF_OUT->TEXT

END
GO